{# {% extends "datasets/base_dataset.html" %} #}
{% load static %}
{% load bootstrap4 %}
{% block content %}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<div class='jumbotron'>
		<button id='pk' style="display:none">{{id}}</button>
		<form method="POST" id='update-dataset' enctype="multipart/form-data">
			{% csrf_token %}
			<div class="modal-header">
				<h1>Update Dataset</h1>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				
				{% bootstrap_form form%}
				
				
			</div>
			<div class="modal-footer">
				<button  type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="submit" class="submit-btn btn btn-primary">Update</button>
			</form>
		</div>
	</div>
	<script type="text/javascript">
	$(function() {
	var modal_body = $('.modal-body');
	$('#update-dataset').submit(function(e){
			var pk = $('#pk').text();
			var clear_file_field = $('#file-clear_id').is(':checked');
			e.preventDefault();
			$('.alert').remove();
			var url = $("input[type='url']").val();
			var fd = new FormData();
			var files = $('input[type="file"]')[0].files[0];
			fd.append('file',files);
			fd.append('csrfmiddlewaretoken','{{ csrf_token }}');
			fd.append('link',url);
			fd.append('clear-previous-file',clear_file_field);
			$.ajax({
				type:'POST',
				url: "http://127.0.0.1:8000/datasets/update/"+pk+"/",
				data: fd,
				contentType: false,
				processData:false,
				success: function(response){
						modal_body.prepend($(response).find('.alert'));
					if ($(response).find('.alert').text().length ==0) {
						console.log($('#modal-update'));
						$("#modal-update").removeClass("in");
    					$(".modal-backdrop").remove();
  						$("#modal-update").hide();
  						location.reload();
					}
				},
				
			});
			
	
	});
	});
	</script>
	
{% endblock  %}